{% extends "base.html" %}
{% block title %}Dashboard | HMV{% endblock %}

{% block content %}

<section class="dash-wrap">

  <!-- HEAD: Hora + Fecha + Acciones rÃ¡pidas -->
  <div class="dash-head">
    <div class="dash-time">
      <div class="dash-clock" id="clock">--:--</div>
      <div class="dash-date" id="date">--</div>
      <div class="dash-muted">Panel principal â€¢ HMV Digital</div>
    </div>

    <div class="dash-quick">
      <!-- Rutas aÃºn no existen: dejamos # para no romper -->
      <a class="hmv-btn-primary" href="#" style="text-decoration:none;">+ Programar cirugÃ­a</a>
      <a class="hmv-btn-outline" href="#" style="text-decoration:none;">Calendario / Historial</a>
    </div>
  </div>

  <!-- PrÃ³xima cirugÃ­a -->
  <section class="hmv-card">
    <div class="hmv-card-header">
      <div>
        <div class="hmv-title" style="font-size: 18px;">PrÃ³xima cirugÃ­a</div>
        <div class="hmv-muted" style="margin-top: 4px;">Lo siguiente del dÃ­a (agenda operativa)</div>
      </div>
    </div>

    <div class="hmv-card-body">
      {% if proxima_cirugia %}
        <div class="dash-next-card">
          <div class="dash-next-main">
            <div class="dash-next-name">{{ proxima_cirugia.tipo }}</div>
            <div class="dash-next-meta">
              {{ proxima_cirugia.hora }} Â· Qx {{ proxima_cirugia.quirofano }} Â· {{ proxima_cirugia.medico }}
            </div>
          </div>
          <a class="hmv-btn-outline" href="#" style="text-decoration:none;">Ver</a>
        </div>
      {% else %}
        <div class="dash-next-empty">
          No hay cirugÃ­as programadas para hoy (aÃºn).
        </div>
      {% endif %}
    </div>
  </section>

  <!-- KPIs -->
  <section class="hmv-card">
    <div class="hmv-card-header">
      <div>
        <div class="hmv-title" style="font-size: 18px;">Resumen</div>
        <div class="hmv-muted" style="margin-top: 4px;">Indicadores rÃ¡pidos del sistema</div>
      </div>
      <div class="hmv-actions">
        <a class="hmv-btn-outline" href="{{ url_for('productos') }}">ğŸ“¦ Productos</a>
        <a class="hmv-btn-outline" href="{{ url_for('movimientos') }}">ğŸ” Movimientos</a>
        <a class="hmv-btn-primary" href="{{ url_for('farmacia_pendientes') }}">ğŸ§¾ Farmacia</a>
      </div>
    </div>

    <div class="hmv-card-body">
      <div class="dash-stats">

        <div class="dash-stat">
          <div class="dash-stat-label">Productos</div>
          <div class="dash-stat-value">{{ productos_count }}</div>
          <div class="dash-stat-sub">Registrados en inventario</div>
        </div>

        <div class="dash-stat">
          <div class="dash-stat-label">Movimientos</div>
          <div class="dash-stat-value">{{ movimientos_count }}</div>
          <div class="dash-stat-sub">Entradas y salidas (piezas)</div>
        </div>

        <div class="dash-stat">
          <div class="dash-stat-label">Pendientes Farmacia</div>
          <div class="dash-stat-value">{{ pendientes_count }}</div>
          <div class="dash-stat-sub">
            Hoy: <span class="badge-hmv" style="margin-left:6px;">{{ pendientes_hoy }}</span>
          </div>

          {% if pendientes_hoy|int > 0 %}
            <div class="dash-stat-hint">Hay evidencia registrada hoy.</div>
          {% else %}
            <div class="dash-stat-hint">Hoy aÃºn no hay registro.</div>
          {% endif %}
        </div>

      </div>
    </div>
  </section>

  <!-- MÃ“DULOS -->
  <section class="hmv-card">
    <div class="hmv-card-header">
      <div>
        <div class="hmv-title" style="font-size: 18px;">MÃ³dulos</div>
        <div class="hmv-muted" style="margin-top: 4px;">Accesos rÃ¡pidos</div>
      </div>
    </div>

    <div class="hmv-card-body">
      <div class="dash-grid">

        <!-- CirugÃ­as -->
        <a href="#" class="dash-card">
          <div class="dash-card-title">ğŸ—“ï¸ Programar cirugÃ­as</div>
          <div class="dash-card-desc">Registrar programaciÃ³n del dÃ­a</div>
          <div class="dash-card-foot">Abrir â†’</div>
        </a>

        <a href="#" class="dash-card">
          <div class="dash-card-title">ğŸ“† Calendario / Historial</div>
          <div class="dash-card-desc">Agenda y cirugÃ­as realizadas</div>
          <div class="dash-card-foot">Abrir â†’</div>
        </a>

        <!-- Inventario -->
        <a href="{{ url_for('productos') }}" class="dash-card">
          <div class="dash-card-title">ğŸ“¦ Productos</div>
          <div class="dash-card-desc">Alta, ediciÃ³n, bÃºsqueda y control base</div>
          <div class="dash-card-foot">Abrir â†’</div>
        </a>

        <a href="{{ url_for('movimientos') }}" class="dash-card">
          <div class="dash-card-title">ğŸ” Entradas / Salidas</div>
          <div class="dash-card-desc">Movimientos por producto (piezas) con notas</div>
          <div class="dash-card-foot">Abrir â†’</div>
        </a>

        <!-- Farmacia -->
        <a href="{{ url_for('farmacia_pendientes') }}" class="dash-card">
          <div class="dash-card-title">ğŸ§¾ Farmacia</div>
          <div class="dash-card-desc">Pendientes, evidencia diaria y trazabilidad</div>
          <div class="dash-card-foot">Abrir â†’</div>
        </a>

        <!-- PrÃ³ximos -->
        <div class="dash-card dash-card--ghost">
          <div class="dash-card-title">ğŸ©º QuirÃ³fano</div>
          <div class="dash-card-desc">Material y medicamentos usados por cirugÃ­a</div>
          <div class="dash-card-foot">PrÃ³ximamente</div>
        </div>

        <div class="dash-card dash-card--ghost">
          <div class="dash-card-title">ğŸ“¦ AlmacÃ©n</div>
          <div class="dash-card-desc">OC, entradas/salidas, stock real</div>
          <div class="dash-card-foot">PrÃ³ximamente</div>
        </div>

      </div>
    </div>
  </section>

</section>

{% endblock %}

{% block scripts %}
<script>
  function pad(n){ return String(n).padStart(2,'0'); }

  function tick(){
    const now = new Date();
    const h = pad(now.getHours());
    const m = pad(now.getMinutes());

    const dias = ["Domingo","Lunes","Martes","MiÃ©rcoles","Jueves","Viernes","SÃ¡bado"];
    const meses = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];

    const dateStr = `${dias[now.getDay()]} ${now.getDate()} de ${meses[now.getMonth()]} ${now.getFullYear()}`;

    const clock = document.getElementById("clock");
    const date = document.getElementById("date");
    if(clock) clock.textContent = `${h}:${m}`;
    if(date) date.textContent = dateStr;
  }

  tick();
  setInterval(tick, 15000);
</script>
{% endblock %}
